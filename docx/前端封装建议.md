# 前端项目封装优化建议

## 1. 组件系统统一与优化

### 当前状态 ✅ 已完成
- ✅ 两套组件系统已统一：`ui/` 目录下的组件已从 `semantic/` 目录重新导出
- ✅ 所有组件使用统一的样式生成机制：`useComponentStyle` + `sx` 函数
- ✅ 已添加完整的语义化组件：`SemanticButton`、`SemanticCard`、`SemanticInput`、`SemanticSlider`、`SemanticAlert`、`SemanticProgress`、`SemanticTooltip`、`SemanticIcon`

### 使用指南
```typescript
// 推荐使用方式：从 ui 目录导入标准组件名
import { Button, Card, Input } from '@/components/ui';

// 也可以直接从 semantic 目录导入语义化组件
import { SemanticButton } from '@/components/semantic/SemanticButton';
```

## 2. 主题配置与工具函数完善

### 当前状态 ✅ 已完成
- ✅ `themeUtils.ts` 中的 `useComponentStyle` 函数已完善，支持所有组件样式
- ✅ `sx` 和 `s` 函数已统一，`s` 函数作为 `sx` 的别名保持向后兼容
- ✅ 已实现语义化样式标记系统，支持 `sx(['text.textPrimary', 'bg.surface'])` 形式

### 使用指南
```typescript
// 主题配置示例（已实现）
import { modernDarkTheme } from '@/themes/modernDarkTheme';

// 样式工具函数使用
import { sx, useComponentStyle } from '@/themes/themeUtils';

// 基础使用
const buttonClasses = sx(['bg.accent', 'text.white', 'rounded-md', 'p-2']);

// 条件样式
const cardClasses = sx(['border.border', 'rounded-lg'], { 'shadow-lg': isHovered });

// 组件样式生成
const buttonStyles = useComponentStyle({ component: 'button', variant: 'primary' });

// 语义化主题访问
const theme = useCurrentTheme();
```

## 3. Composables 扩展与优化

### 当前状态 ✅ 已完成
- ✅ 已添加多个业务逻辑 composables：`useAIProcess`、`useAIWorkflow`、`useCanvas`、`useProject`、`useUser`
- ✅ 已优化现有 composables：`useStatusBar`、`useCanvasTransform`
- ✅ 业务逻辑已从组件中抽象到 composables

### 使用指南
```typescript
// AI 工作流 composable
import { useAIWorkflow } from '@/composables/useAIWorkflow';

const { processImage, cancelProcess } = useAIWorkflow();

// 画布操作 composable
import { useCanvas } from '@/composables/useCanvas';

const { zoomIn, zoomOut, panCanvas } = useCanvas();

// 状态管理 composable
import { useStatusBar } from '@/components/common/composables/useStatusBar';

const { setStatus, clearStatus } = useStatusBar();
```

## 4. API 封装与数据管理

### 当前状态 ✅ 已完成
- ✅ 统一的 API 封装已实现：`apiClient` 提供所有 HTTP 方法和业务接口
- ✅ 已添加数据管理层：使用 Zustand 进行状态管理
- ✅ 已实现 React Query 用于数据缓存和失效策略

### 使用指南
```typescript
// API 客户端使用
import { apiClient, apiService } from '@/lib/api'; // apiService 是 apiClient 的别名

// 基础 HTTP 请求
const response = await apiClient.get('/api/resource');
const result = await apiClient.post('/api/resource', data);

// 业务 API 调用
const segmentResult = await apiClient.segmentImage(imageFile, points, pointLabels);
const normalMapResult = await apiClient.generateNormalMap(imageFile, strength);

// 状态管理
import { useAppStore } from '@/stores/appStore';

const { theme, setTheme } = useAppStore();

// React Query 使用
import { useQuery, useMutation } from '@tanstack/react-query';

const { data, isLoading } = useQuery({ queryKey: ['resource'], queryFn: fetchResource });
```

## 5. 动画系统封装

### 当前状态 ✅ 已完成
- ✅ 统一的动画工具函数已实现：`Animations` 对象包含所有动画配置
- ✅ 已添加动画组件：`Animated`、`AnimatedContainer`、`FadeIn`
- ✅ 组件中的动画实现已统一

### 使用指南
```typescript
// 动画工具导入
import Animations from '@/lib/animations';
import { Animated, AnimatedContainer, FadeIn } from '@/components/animation';

// 动画类名使用
const fadeInClass = Animations.EnterAnimation.FADE_IN;
const transitionClass = Animations.Transition.BASE;

// 动画组件使用
<AnimatedContainer animation="fadeIn">
  <div>内容</div>
</AnimatedContainer>

<FadeIn>
  <div>淡入内容</div>
</FadeIn>

<Animated animation="slideUp">
  <div>上滑动画</div>
</Animated>
```

## 6. 类型系统完善

### 当前状态 ✅ 已完成
- ✅ 已创建统一的类型文件：`src/types/index.ts`
- ✅ 已扩展主题类型，支持组件样式配置
- ✅ 类型定义已集中管理

### 使用指南
```typescript
// 统一类型导入
import { AIWorkflowStatus, CanvasState } from '@/types';

// 主题类型使用
import type { ThemeConfig, ComponentStyleConfig } from '@/themes/types';
```

## 7. 国际化（i18n）封装

### 当前状态 ✅ 已完成
- ✅ 已实现完整的 i18n 封装：支持多语言切换
- ✅ 翻译资源已组织良好，支持 en、zh-CN、ja 三种语言
- ✅ 已添加 `useTranslation` composable，支持格式化功能

### 使用指南
```typescript
// 翻译 hook 使用
import { useTranslation } from '@/i18n/useTranslation';

const { t, tNumber } = useTranslation();

// 基础翻译
const title = t('common.title');

// 带参数翻译
const count = t('common.count', { value: 5 });

// 数字格式化
const formattedNumber = tNumber('common.amount', 1000);
```

## 8. 测试工具封装

### 当前状态 ⏳ 待实现
- ⏳ 缺少统一的测试工具和辅助函数
- ⏳ 建议添加 Jest 或 Vitest 测试框架

### 建议实现
```typescript
// 测试辅助函数建议
import { render } from '@testing-library/react';
import { ThemeProvider } from '@/themes/ThemeContext';
import { modernDarkTheme } from '@/themes/modernDarkTheme';

export const renderWithTheme = (component: React.ReactElement) => {
  return render(
    <ThemeProvider theme={modernDarkTheme}>
      {component}
    </ThemeProvider>
  );
};
```

## 9. 代码规范与质量

### 当前状态 ✅ 已实现
- ✅ 已配置 ESLint 和 TypeScript 类型检查
- ✅ 已添加 lint 和 typecheck 脚本
- ✅ 代码风格已统一

### 使用指南
```bash
# 运行类型检查
npm run typecheck

# 运行 lint 检查
npm run lint

# 运行构建
npm run build
```

## 10. 属性面板封装

### 当前状态 ✅ 已完成
- ✅ 已创建语义化属性面板组件：`SemanticPropertyPanel`
- ✅ 已添加配套组件：`PropertyGroup`、`PropertyField`
- ✅ 已在主题配置中添加面板样式
- ✅ 已在 `ui` 目录下重新导出为 `PropertyPanel`

### 使用指南
```typescript
// 标准使用方式
import { PropertyPanel, PropertyGroup, PropertyField } from '@/components/ui';

// 基础用法
<PropertyPanel title="属性面板">
  <PropertyGroup title="通用设置">
    <PropertyField label="名称">
      <Input placeholder="输入名称" />
    </PropertyField>
    <PropertyField label="大小">
      <Slider min={0} max={100} value={50} />
    </PropertyField>
  </PropertyGroup>
  
  <PropertyGroup title="高级设置">
    <PropertyField label="启用选项">
      <button className="bg.accent text.white p-2 rounded">启用</button>
    </PropertyField>
  </PropertyGroup>
</PropertyPanel>

// 自定义宽度
<PropertyPanel title="属性面板" width="w-96">
  {/* 面板内容 */}
</PropertyPanel>
```

## 11. 功能变更对照表

### 当前状态 ✅ 已完成
- ✅ 已创建功能变更对照表，记录旧封装功能的去除范围和移动路径
- ✅ 已建立完整的功能变更映射关系
- ✅ 已提供替换建议和验证方法

### 参考文档
详细的功能变更对照表请参考：`src/docs/封装功能变更对照表.md`

## 实施情况总结

| 优化项 | 状态 | 完成时间 |
|--------|------|----------|
| 组件系统统一 | ✅ 已完成 | 已完成 |
| 主题配置完善 | ✅ 已完成 | 已完成 |
| Composables 扩展 | ✅ 已完成 | 已完成 |
| API 封装统一 | ✅ 已完成 | 已完成 |
| 动画系统封装 | ✅ 已完成 | 已完成 |
| 类型系统完善 | ✅ 已完成 | 已完成 |
| i18n 封装 | ✅ 已完成 | 已完成 |
| 属性面板封装 | ✅ 已完成 | 已完成 |
| 测试工具封装 | ⏳ 待实现 | 计划中 |
| 代码规范配置 | ✅ 已完成 | 已完成 |

## 最佳实践建议

1. **组件使用**：优先从 `@/components/ui` 导入组件，确保统一接口
2. **样式使用**：使用 `sx()` 函数，支持语义化样式标记
3. **API 调用**：使用 `apiClient` 或 `apiService` 统一调用
4. **Composables**：从正确路径导入，注意部分功能已移动位置
5. **动画效果**：使用 `Animations` 对象统一管理动画类名
6. **类型定义**：从 `@/types` 导入统一类型
7. **主题访问**：使用 `useCurrentTheme` 或 `useComponentStyle`

## 验证方法

1. 运行 `npm run typecheck` 检查类型错误
2. 运行 `npm run lint` 检查代码规范
3. 运行 `npm run build` 确保构建通过
4. 手动测试各功能模块，确保封装功能正常工作
5. 检查浏览器控制台，确保无未捕获的错误

## 结论

前端项目已成功实现了高度的封装和统一，提高了代码的可维护性、可扩展性和一致性。所有核心封装功能已按照建议完成，后续可根据业务需求继续扩展和优化。

建议团队成员严格遵循封装规范，使用统一的接口和工具函数，确保代码质量和一致性。